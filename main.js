/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var C=Object.defineProperty;var P=Object.getOwnPropertyDescriptor;var N=Object.getOwnPropertyNames;var $=Object.prototype.hasOwnProperty;var q=(s,a)=>{for(var e in a)C(s,e,{get:a[e],enumerable:!0})},J=(s,a,e,t)=>{if(a&&typeof a=="object"||typeof a=="function")for(let n of N(a))!$.call(s,n)&&n!==e&&C(s,n,{get:()=>a[n],enumerable:!(t=P(a,n))||t.enumerable});return s};var U=s=>J(C({},"__esModule",{value:!0}),s);var G={};q(G,{default:()=>V});module.exports=U(G);var E=require("obsidian");var I=require("obsidian"),v=class extends I.ItemView{constructor(e,t,n){super(t);this.app=e,this.settings=n,this.containerEl=this.contentEl,this.registerEvent(this.app.vault.on("modify",this.updateView.bind(this))),this.registerEvent(this.app.workspace.on("file-open",this.updateView.bind(this)))}getViewType(){return"outline-view"}getDisplayText(){return"Outline"}async onOpen(){this.updateView()}async updateView(){let e=this.containerEl;e.empty(),e.createEl("h4",{text:"Outline"});let t=this.app.workspace.getActiveFile();if(t){let n=await this.app.vault.read(t),i=n.match(/^### .+/gm);i?i.forEach((o,r)=>{let c=o.replace(/^###\s*/,""),h=e.createEl("div",{cls:"header"});h.createEl("span",{text:c,cls:"header-text"});let p=h.createEl("button",{text:"\u25BC",cls:"toggle"}),l=e.createEl("div",{cls:"content hidden"}),d=i[r+1]?n.indexOf(i[r+1]):n.length,u=n.substring(n.indexOf(o)+o.length,d).trim(),g=l.createEl("textarea",{text:u,cls:"content-textarea"}),f=l.createEl("button",{text:"Apply",cls:"apply-button"});p.addEventListener("click",()=>{let m=l.hasClass("hidden");l.toggleClass("hidden",!m),p.textContent=m?"\u25B2":"\u25BC"}),f.addEventListener("click",async()=>{let m=g.value,T=n.substring(0,n.indexOf(o)+o.length)+`
`+m+`
`+n.substring(d);await this.app.vault.modify(t,T),this.updateView()})}):e.createEl("div",{text:"No headers found"})}else e.createEl("div",{text:"No file open"});this.containerEl.querySelectorAll(".header").forEach(n=>{n.style.border=`1px solid ${this.settings.borderColor}`})}async onClose(){this.containerEl.empty()}};var O=require("obsidian"),x=class extends O.ItemView{constructor(e,t,n){super(t);this.app=e,this.settings=n,this.containerEl=this.contentEl,this.registerEvent(this.app.vault.on("modify",this.updateView.bind(this))),this.registerEvent(this.app.workspace.on("file-open",this.updateView.bind(this)))}getViewType(){return"create-view"}getDisplayText(){return"Create"}async onOpen(){this.updateView()}async updateView(){let e=this.containerEl;e.empty();let t=e.createEl("div",{cls:"create-header-container"});t.createEl("h2",{text:"Create"});let n=t.createEl("button",{cls:"toggle-all-button",attr:{"aria-label":"Toggle all sections"}});n.innerHTML="&#x25BC;";let i=!0;n.addEventListener("click",()=>{i=!i,n.innerHTML=i?"&#x25BC;":"&#x25B2;",this.containerEl.querySelectorAll(".create-content").forEach(r=>{r.toggleClass("hidden",!i)}),this.containerEl.querySelectorAll(".toggle-button").forEach(r=>{r.textContent=i?"\u25BC":"\u25B2"})});let o=this.app.workspace.getActiveFile();if(o){let r=await this.app.vault.read(o),c=r.match(/^### .+/gm);c?c.forEach((h,p)=>{let l=h.replace(/^###\s*/,""),d=e.createEl("div",{cls:"create-section"}),u=d.createEl("div",{cls:"create-header"});u.createEl("span",{text:l,cls:"header-text"});let g=u.createEl("button",{text:"\u25BC",cls:"toggle-button"}),f=d.createEl("div",{cls:"create-content"}),m=c[p+1]?r.indexOf(c[p+1]):r.length,T=r.substring(r.indexOf(h)+h.length,m).trim(),W=f.createEl("textarea",{text:T,cls:"content-textarea"}),D=f.createEl("button",{text:"Apply",cls:"apply-button"});g.addEventListener("click",()=>{let w=f.hasClass("hidden");f.toggleClass("hidden",!w),g.textContent=w?"\u25BC":"\u25B2"}),D.addEventListener("click",async()=>{let w=W.value,B=r.substring(0,r.indexOf(h)+h.length)+`

`+w+`

`+r.substring(m);await this.app.vault.modify(o,B),this.updateView()})}):e.createEl("div",{text:"No headers found"})}else e.createEl("div",{text:"No file open"});this.containerEl.querySelectorAll(".header").forEach(r=>{r.style.border=`1px solid ${this.settings.borderColor}`})}async onClose(){this.containerEl.empty()}};var M=require("obsidian");async function H(s){let a=`${s.vault.configDir}/.savedsentenceversions`;if(await s.vault.adapter.exists(a)){let e=await s.vault.adapter.read(a);return JSON.parse(e)}return{}}async function y(s,a){let e=`${s.vault.configDir}/.savedsentenceversions`;await s.vault.adapter.write(e,JSON.stringify(a,null,2))}function R(s,a){let e=s.containerEl;e.empty(),e.createEl("h4",{text:"Sentences"});let t=a.match(/^### .+/gm);t?t.forEach((n,i)=>{let o=n.replace(/^###\s*/,""),r=e.createEl("h3",{text:o}),c=a.indexOf(n),h=t[i+1]?a.indexOf(t[i+1]):a.length;a.substring(c+n.length,h).trim().split(".").filter(d=>d.trim().length>0).forEach(d=>{let u=e.createEl("div",{cls:"sentence"});u.createEl("span",{text:d.trim(),cls:"sentence-text"}),u.addEventListener("click",g=>{g.stopPropagation(),S(s,n,d,a,u)})})}):e.createEl("div",{text:"No headers found"})}function S(s,a,e,t,n){let o=s.containerEl.querySelector(".rewrite-container");if(o){let d=o.originalSentenceEl;d&&o.replaceWith(d)}let r=document.createElement("div");r.classList.add("rewrite-container");let c=document.createElement("div");c.classList.add("original-sentence"),c.innerHTML=`<span class="original-sentence-text">${e.trim()}</span>`,r.appendChild(c),k(s,r,a,e,e,t),(s.sentenceVersions[e]||[]).forEach(d=>{k(s,r,a,e,d,t)});let p=document.createElement("button");p.classList.add("add-rewrite-button"),p.textContent="+",p.addEventListener("click",()=>{k(s,r,a,e,"",t)}),r.appendChild(p),n.replaceWith(r),r.originalSentenceEl=n;let l=d=>{r.contains(d.target)||(r.replaceWith(n),document.removeEventListener("click",l))};setTimeout(()=>document.addEventListener("click",l),0)}function k(s,a,e,t,n,i){let o=document.createElement("div");o.classList.add("rewrite-option"),n===t&&o.classList.add("active");let r=document.createElement("span");r.classList.add("select-circle"),r.innerHTML=n===t?"\u25CF":"\u25CB",o.appendChild(r);let c=document.createElement("textarea");c.classList.add("rewrite-textarea"),c.value=n,o.appendChild(c);let h=Y(async()=>{let l=c.value;s.sentenceVersions[t]||(s.sentenceVersions[t]=[]);let d=s.sentenceVersions[t].indexOf(n);d>-1?s.sentenceVersions[t][d]=l:s.sentenceVersions[t].includes(l)||s.sentenceVersions[t].push(l),await y(s.app,s.sentenceVersions)},500);c.addEventListener("input",h),r.addEventListener("click",async()=>{let l=s.app.workspace.getActiveFile();if(l){await h();let u=(await s.app.vault.read(l)).replace(t,c.value);await s.app.vault.modify(l,u),a.querySelectorAll(".rewrite-option").forEach(g=>g.classList.remove("active")),o.classList.add("active"),s.sentenceVersions[t]||(s.sentenceVersions[t]=[]),s.sentenceVersions[t].includes(c.value)||s.sentenceVersions[t].push(c.value),await y(s.app,s.sentenceVersions),S(s,e,c.value,u,a.parentElement)}r.innerHTML="\u25CF"});let p=document.createElement("button");p.classList.add("delete-button"),p.textContent="Delete",o.appendChild(p),p.addEventListener("click",async()=>{let l=s.sentenceVersions[t].indexOf(n);l>-1&&(s.sentenceVersions[t].splice(l,1),await y(s.app,s.sentenceVersions),o.remove(),S(s,e,t,i,a.parentElement))}),a.appendChild(o)}function Y(s,a){let e;return function(...t){clearTimeout(e),e=window.setTimeout(()=>s.apply(this,t),a)}}var b=class extends M.ItemView{constructor(e,t,n){super(t);this.sentenceVersions={};this.app=e,this.settings=n,this.containerEl.addClass("rewrite-view-container"),this.registerEvent(this.app.vault.on("modify",this.updateView.bind(this))),this.registerEvent(this.app.workspace.on("file-open",this.updateView.bind(this)))}getViewType(){return"rewrite-view"}getDisplayText(){return"Rewrite"}async onOpen(){this.sentenceVersions=await H(this.app),this.updateView()}async updateView(){let e=this.containerEl;e.empty(),e.createEl("h4",{text:"Rewrite"});let t=this.app.workspace.getActiveFile();if(t){let n=await this.app.vault.read(t);R(this,n)}else e.createEl("div",{text:"No file open"})}};var F=require("obsidian"),L=class extends F.ItemView{constructor(e,t){super(t);this.reorderItems=[];this.app=e,this.containerEl.addClass("reorder-view-container"),this.registerEvent(this.app.vault.on("modify",this.updateView.bind(this))),this.registerEvent(this.app.workspace.on("file-open",this.updateView.bind(this)))}getViewType(){return"reorder-view"}getDisplayText(){return"Reorder"}async onOpen(){this.updateView()}async updateView(){let e=this.containerEl;e.empty(),e.createEl("h4",{text:"Reorder"});let t=this.app.workspace.getActiveFile();if(t){let n=await this.app.vault.read(t);this.extractReorderItems(n),this.showReorderItems()}else e.createEl("div",{text:"No file open"})}extractReorderItems(e){this.reorderItems=[];let t=e.split(`
`),n;t.forEach(i=>{i.startsWith("### ")?(this.reorderItems.push({type:"header",content:i.substring(4).trim().toUpperCase(),originalContent:i.trim()}),n=i.trim()):i.trim()&&i.split(/(?<=\.|\?|\!)\s+/).filter(r=>r.trim()).forEach(r=>{this.reorderItems.push({type:"sentence",content:r.trim(),originalContent:n})})})}showReorderItems(){let t=this.containerEl.createEl("div",{cls:"reorder-list"});this.reorderItems.forEach((n,i)=>{t.createEl("div",{cls:`reorder-item ${n.type==="header"?"header-item":"sentence-item"}`,attr:{"data-index":i.toString(),draggable:"true"}}).createEl("span",{text:n.content,cls:"item-content"})}),this.addDragListeners(t)}addDragListeners(e){let t=null;e.addEventListener("dragstart",n=>{var i;n.target instanceof HTMLElement&&(t=n.target,(i=n.dataTransfer)==null||i.setData("text/plain",n.target.dataset.index||""),setTimeout(()=>{n.target instanceof HTMLElement&&n.target.classList.add("dragging")},0))}),e.addEventListener("dragover",n=>{if(n.preventDefault(),!t)return;let i=n.target.closest(".reorder-item");if(i&&i!==t){let o=i.getBoundingClientRect(),r=(o.top+o.bottom)/2;n.clientY<r?(i.style.borderTop="2px solid #007bff",i.style.borderBottom=""):(i.style.borderBottom="2px solid #007bff",i.style.borderTop="")}}),e.addEventListener("dragleave",n=>{n.target instanceof HTMLElement&&(n.target.style.borderTop="",n.target.style.borderBottom="")}),e.addEventListener("drop",async n=>{if(n.preventDefault(),!t)return;let i=n.target.closest(".reorder-item");if(i&&i!==t){let o=parseInt(t.dataset.index||"0",10),r=parseInt(i.dataset.index||"0",10),c=i.getBoundingClientRect(),h=(c.top+c.bottom)/2,p=n.clientY>h;this.reorderItems=this.reorderItemsArray(o,r,p),await this.updateFileContent(),this.updateView()}}),e.addEventListener("dragend",()=>{t&&(t.classList.remove("dragging"),t=null),e.querySelectorAll(".reorder-item").forEach(n=>{n.style.borderTop="",n.style.borderBottom=""})})}reorderItemsArray(e,t,n){let i=[...this.reorderItems],[o]=i.splice(e,1);return n?i.splice(t+1,0,o):i.splice(t,0,o),i}async updateFileContent(){let e=this.app.workspace.getActiveFile();if(e){let t="",n="";this.reorderItems.forEach(i=>{i.type==="header"?(n&&(t+=`

`),n=i.originalContent||i.content,t+=`${n}

`):t+=`${i.content} `}),await this.app.vault.modify(e,t.trim())}}};var j={borderColor:"#FFA500"},V=class extends E.Plugin{async onload(){await this.loadSettings(),this.registerView("outline-view",e=>new v(this.app,e,this.settings)),this.addRibbonIcon("dice","Open Outline",()=>{this.activateView("outline-view")}),this.registerView("create-view",e=>new x(this.app,e,this.settings)),this.addRibbonIcon("pencil-plus","Open Create",()=>{this.activateView("create-view")}),this.addCommand({id:"open-create-view",name:"Open Create View",callback:()=>this.activateView("create-view")}),this.registerView("rewrite-view",e=>new b(this.app,e,this.settings)),this.addRibbonIcon("edit","Open Rewrite",()=>{this.activateView("rewrite-view")}),this.addCommand({id:"open-rewrite-view",name:"Open Rewrite View",callback:()=>this.activateView("rewrite-view")}),this.registerView("reorder-view",e=>new L(this.app,e)),this.addRibbonIcon("list-ordered","Open Reorder",()=>{this.activateView("reorder-view")}),this.addCommand({id:"open-reorder-view",name:"Open Reorder View",callback:()=>this.activateView("reorder-view")}),this.addSettingTab(new A(this.app,this))}onunload(){this.app.workspace.detachLeavesOfType("outline-view"),this.app.workspace.detachLeavesOfType("create-view"),this.app.workspace.detachLeavesOfType("rewrite-view"),this.app.workspace.detachLeavesOfType("reorder-view")}async loadSettings(){this.settings=Object.assign({},j,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async activateView(e){this.app.workspace.detachLeavesOfType(e);let t=this.app.workspace.getRightLeaf(!1);t&&(await t.setViewState({type:e,active:!0}),this.app.workspace.revealLeaf(this.app.workspace.getLeavesOfType(e)[0]))}},A=class extends E.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){let{containerEl:e}=this;e.empty(),e.createEl("h2",{text:"ArtPlug Settings"}),new E.Setting(e).setName("Border Color").setDesc("Set the border color for the headers").addText(t=>t.setPlaceholder("Enter color code").setValue(this.plugin.settings.borderColor).onChange(async n=>{this.plugin.settings.borderColor=n,await this.plugin.saveSettings()}))}};
